async function getHeaders(options: ApiRequestOptions, config: Config): Promise<Record<string, string>> {
    const token = await resolve(options, config.TOKEN);
    const username = await resolve(options, config.USERNAME);
    const password = await resolve(options, config.PASSWORD);
    const defaultHeaders = await resolve(options, config.HEADERS);

    const headers = new Map([
        ['Accept', 'application/json'],
        ...(defaultHeaders ? Object.entries(defaultHeaders) : []),
        ...(options.headers ? Object.entries(options.headers) : []),
    ]);

    if (isStringWithValue(token)) {
        headers.set('Authorization', `Bearer ${token}`);
    }

    if (isStringWithValue(username) && isStringWithValue(password)) {
        const credentials = btoa(`${username}:${password}`);
        headers.set('Authorization', `Basic ${credentials}`);
    }

    if (options.body) {
        if (options.mediaType) {
            headers.set('Content-Type', options.mediaType);
        } else if (isBlob(options.body)) {
            headers.set('Content-Type', options.body.type || 'application/octet-stream');
        } else if (isString(options.body)) {
            headers.set('Content-Type', 'text/plain');
        } else {
            headers.set('Content-Type', 'application/json');
        }
    }
    return Object.fromEntries(headers.entries());
}
